#!/usr/bin/env node

var pmx = require('pmx');
//Log routes and latency.
pmx.init({
  http: true
});
// You must do this BEFORE any require('http')

var logger = require('../src/utils/logger');

module.exports = new Promise(function(resolve, reject) {

  require('../src/app')
    .then(function(serverObjects) {

      var port = process.env.PORT || 3000;

      var server = serverObjects.app.listen(port, function() {
        logger.debug('Restify server listening on port ' + server.address().port);
        logger.salute(function() {
          resolve(serverObjects);
        });

      });
    })
    .catch(function(err) {
      console.log('ERROR launching Restify application', err);
      reject(err);
    });
});
